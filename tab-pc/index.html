<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Tab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sf: [
                "-apple-system",
                "BlinkMacSystemFont",
                "San Francisco",
                "Helvetica Neue",
                "sans-serif",
              ],
            },
          },
        },
      };
    </script>
    <script>
      async function getFaviconUrl(url) {
        try {
          const domain = new URL(url).hostname;
          // Utiliser directement l'API Google Favicons qui est plus fiable
          return `https://www.google.com/s2/favicons?domain=${domain}&sz=128`;
        } catch (e) {
          console.error("Erreur lors de la r√©cup√©ration du favicon:", e);
          // Retourner une ic√¥ne par d√©faut en cas d'erreur
          return 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üåê</text></svg>';
        }
      }

      function handleShortcutClick(event, position) {
        event.preventDefault();
        const shortcut = document.querySelector(
          `[data-position="${position}"]`
        );
        const iconContainer = shortcut.querySelector(".shortcut-icon");
        const isEmpty = iconContainer.getAttribute("data-empty") === "true";

        if (event.type === "contextmenu") {
          showContextMenu(event, position);
        } else if (isEmpty) {
          openConfigModal(position);
        } else {
          window.location.href = shortcut.href;
        }
      }

      function showContextMenu(event, position) {
        event.preventDefault();
        const contextMenu = document.getElementById("contextMenu");
        contextMenu.style.left = `${event.pageX}px`;
        contextMenu.style.top = `${event.pageY}px`;
        contextMenu.setAttribute("data-position", position);
        contextMenu.classList.remove("hidden");
        contextMenu.style.background = "none";
        contextMenu.style.backgroundColor = "transparent";

        document.addEventListener("click", closeContextMenu);
      }

      function closeContextMenu() {
        document.getElementById("contextMenu").classList.add("hidden");
        document.removeEventListener("click", closeContextMenu);
      }

      function generateShortcut(i) {
        return `
          <div class="shortcut-container" 
             ondragover="handleDragOver(event)" 
             ondrop="handleDrop(event, '${i}')"
             ondragenter="handleDragEnter(event)"
             ondragleave="handleDragLeave(event)">
            <a href="#" 
             draggable="true"
             ondragstart="handleDragStart(event, '${i}')"
             onclick="handleShortcutClick(event, '${i}')" 
             oncontextmenu="handleShortcutClick(event, '${i}')"
             data-position="${i}"
             class="group p-6 backdrop-blur-xl bg-white/90 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 block">
              <div class="text-center">
                <div class="shortcut-icon" data-empty="true">
                </div>
                <div class="text-white font-medium shortcut-title">Ajouter un raccourci</div>
              </div>
            </a>
          </div>`;
      }

      function handleDragOver(event) {
        event.preventDefault();
      }

      function handleDragEnter(event) {
        event.preventDefault();
        const container = event.currentTarget;
        container.querySelector("a").classList.add("bg-white/40");
      }

      function handleDragLeave(event) {
        event.preventDefault();
        const container = event.currentTarget;
        container.querySelector("a").classList.remove("bg-white/40");
      }

      async function handleDrop(event, newPosition) {
        event.preventDefault();
        const container = event.currentTarget;
        container.querySelector("a").classList.remove("bg-white/40");

        const oldPosition = event.dataTransfer.getData('text/plain');
        
        // Si c'est un drag externe (URL)
        if (oldPosition === '') {
          // Garder la logique existante pour le drop d'URL
          const data = event.dataTransfer.getData("text");
          if (!data) return;
          try {
            const url = new URL(data);
            let title = "";
            try {
              const response = await fetch(url.href);
              const html = await response.text();
              const doc = new DOMParser().parseFromString(html, "text/html");
              title = doc.title || url.hostname;
            } catch (e) {
              title = url.hostname;
            }
  
            const shortcuts = JSON.parse(
              localStorage.getItem("shortcuts") || "{}"
            );
            const faviconUrl = await getFaviconUrl(url.href);
            shortcuts[newPosition] = { title, url: url.href, faviconUrl };
            localStorage.setItem("shortcuts", JSON.stringify(shortcuts));
  
            reloadShortcuts(); // Au lieu de reloadWithTransition()
          } catch (e) {
            console.error("Invalid URL dropped:", e);
          }
          return;
        }
  
        // Si c'est un drag interne (r√©arrangement)
        const activeTab = localStorage.getItem("activeTab") || "personal";
        const shortcuts = JSON.parse(localStorage.getItem(`shortcuts_${activeTab}`) || "{}");
        
        // √âchanger les raccourcis
        const temp = shortcuts[oldPosition];
        shortcuts[oldPosition] = shortcuts[newPosition];
        shortcuts[newPosition] = temp;
  
        // Sauvegarder les changements
        localStorage.setItem(`shortcuts_${activeTab}`, JSON.stringify(shortcuts));
        localStorage.setItem("shortcuts", JSON.stringify(shortcuts));
  
        // Recharger les raccourcis
        reloadShortcuts();
  
        // Supprimer les classes de style temporaires
        document.querySelectorAll('.shortcut-container a').forEach(el => {
          el.classList.remove('opacity-50');
        });
      }

      function handleDragStart(event, position) {
        event.dataTransfer.setData('text/plain', position);
        event.currentTarget.classList.add('opacity-50');
      }

      function generateAddRowButton() {
        return `
          <button
             onclick="addMoreShortcuts()"
             class="group p-6 backdrop-blur-xl bg-white/30 rounded-2xl shadow-lg hover:shadow-xl hover:bg-white/40 transition-all duration-300 border-2 border-dashed border-white/30 w-full"
             id="addRowButton">
            <div class="text-center">
              <div class="flex justify-center mb-2">
                <svg class="w-8 h-8 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
              </div>
              <div class="text-white/70 font-medium">Ajouter d'avantages de raccourcis</div>
            </div>
          </button>`;
      }

      function addMoreShortcuts() {
        const currentCount =
          document.querySelectorAll("[data-position]").length;
        const addRowButton = document.getElementById("addRowButton");

        for (let i = currentCount; i < currentCount + 4; i++) {
          grid.insertBefore(
            document
              .createRange()
              .createContextualFragment(generateShortcut(i)),
            addRowButton
          );
        }

        localStorage.setItem("shortcutCount", currentCount + 4);
        reloadShortcuts(); // Au lieu de reloadWithTransition()
      }

      async function saveShortcut() {
        const modal = document.getElementById("configModal");
        const position = modal.getAttribute("data-position");
        const title = document.getElementById("shortcutTitle").value;
        let url = document.getElementById("shortcutUrl").value.trim();

        if (!url.match(/^https?:\/\//i)) {
          url = "https://" + url;
        }

        try {
          const faviconUrl = await getFaviconUrl(url);
          const activeTab = localStorage.getItem("activeTab") || "personal";
          const shortcuts = JSON.parse(
            localStorage.getItem(`shortcuts_${activeTab}`) || "{}"
          );
          shortcuts[position] = { title, url, faviconUrl };
          localStorage.setItem(
            `shortcuts_${activeTab}`,
            JSON.stringify(shortcuts)
          );
          localStorage.setItem("shortcuts", JSON.stringify(shortcuts));

          closeConfigModal();
          reloadShortcuts(); // Au lieu de reloadWithTransition()
        } catch (e) {
          console.error("Erreur lors de la sauvegarde du raccourci:", e);
        }
      }

      function openConfigModal(position) {
        const modal = document.getElementById("configModal");
        const titleInput = document.getElementById("shortcutTitle");
        
        modal.setAttribute("data-position", position);
        titleInput.value = "";
        document.getElementById("shortcutUrl").value = "";
        document.getElementById("saveButton").disabled = true;

        modal.classList.remove("hidden");
        
        // Force focus sur l'input du titre avec un petit d√©lai pour √™tre s√ªr que la modal est bien affich√©e
        setTimeout(() => {
          titleInput.focus();
        }, 50);
      }

      function closeConfigModal() {
        document.getElementById("configModal").classList.add("hidden");
      }

      function editShortcut(position) {
        openConfigModal(position, true);
        closeContextMenu();
      }

      function deleteShortcut() {
        const position = document
          .getElementById("contextMenu")
          .getAttribute("data-position");
        const activeTab = localStorage.getItem("activeTab") || "personal";

        const shortcuts = JSON.parse(
          localStorage.getItem(`shortcuts_${activeTab}`) || "{}"
        );
        delete shortcuts[position];
        localStorage.setItem(
          `shortcuts_${activeTab}`,
          JSON.stringify(shortcuts)
        );
        localStorage.setItem("shortcuts", JSON.stringify(shortcuts));

        closeContextMenu();
        reloadShortcuts(); // Au lieu de reloadWithTransition()
      }

      document.addEventListener("DOMContentLoaded", () => {
        function focusSearch() {
          const searchInput = document.getElementById("searchInput");
          if (searchInput) {
            searchInput.focus();
          }
        }

        focusSearch();
        setTimeout(focusSearch, 100);

        document.addEventListener("visibilitychange", () => {
          if (document.visibilityState === "visible") {
            focusSearch();
          }
        });

        window.addEventListener("focus", focusSearch);
        document.addEventListener("mouseenter", focusSearch);
        document.addEventListener("keydown", focusSearch, { once: true });

        const grid = document.getElementById("shortcutGrid");
        const shortcuts = JSON.parse(localStorage.getItem("shortcuts") || "{}");
        const shortcutCount = parseInt(
          localStorage.getItem("shortcutCount") || "8"
        );

        for (let i = 0; i < shortcutCount; i++) {
          grid.innerHTML += generateShortcut(i);
        }

        grid.innerHTML += generateAddRowButton();

        Object.entries(shortcuts).forEach(([position, data]) => {
          const shortcut = document.querySelector(
            `[data-position="${position}"]`
          );
          if (shortcut) {
            shortcut.href = data.url;
            shortcut.onclick = (e) => {
              e.preventDefault();
              window.location.href = data.url;
            };
            shortcut.querySelector(".shortcut-title").textContent = data.title;
            const iconContainer = shortcut.querySelector(".shortcut-icon");
            iconContainer.removeAttribute("data-empty");
            iconContainer.innerHTML = `
              <img src="${data.faviconUrl}" 
                 class="w-8 h-8 mt-2 mb-2 group-hover:scale-120 transition-transform duration-300" 
                 alt="${data.title}" 
                 onerror="this.src='data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'><text y=\'.9em\' font-size=\'90\'>üåê</text></svg>\'">`;
          }
        });

        const searchInput = document.getElementById("searchInput");
        const searchButton = document.querySelector(".absolute svg");

        searchInput.addEventListener("keydown", handleSearch);
        searchButton.addEventListener("click", handleSearch);

        const menuButton = document.getElementById("mobileMenuButton");
        const sidebar = document.getElementById("sidebar");

        if (menuButton) {
          menuButton.addEventListener("click", () => {
            sidebar.classList.toggle("mobile-hidden");
            menuButton.classList.toggle("open");
          });
        }

        const searchIcon = document.querySelector(".absolute svg");
        const currentSearch = document.getElementById("currentSearch");

        if (searchInput && searchIcon && currentSearch) {
          searchInput.addEventListener("keydown", handleSearch);
          searchIcon.addEventListener("click", handleSearch);
          currentSearch.addEventListener("click", () => {
            const dropdown = document.getElementById("searchEngineDropdown");
            if (dropdown) {
              dropdown.classList.toggle("hidden");
            }
          });
        }

        document.querySelectorAll(".search-option").forEach((option) => {
          option.addEventListener("click", (e) => {
            const value = e.currentTarget.dataset.value;
            const img = e.currentTarget.querySelector("img");
            const searchBtn = document.querySelector("#currentSearch img");

            if (searchBtn && img) {
              searchBtn.src = img.src;
            }

            const searchEngine = document.getElementById("searchEngine");
            if (searchEngine) {
              searchEngine.value = value;
            }

            const searchInput = document.getElementById("searchInput");
            if (searchInput) {
              const currentText = searchInput.value.trim();
              let newText = currentText;

              if (currentText.startsWith("/")) {
                const parts = currentText.substring(1).split(" ");
                const possibleCommand = parts[0].toLowerCase();
                const validCommands = [
                  "g",
                  "yt",
                  "gh",
                  "w",
                  "r",
                  "so",
                  "a",
                  "n",
                  "sp",
                  "tw",
                  "ig",
                  "maps",
                  "i",
                  "as", // Ajout du raccourci asialand
                  "ac", // Ajout du raccourci acadia
                ];
                if (validCommands.includes(possibleCommand)) {
                  newText = parts.slice(1).join(" ");
                }
              }

              searchInput.value =
                newText.length > 0 ? `/${value} ${newText}` : `/${value} `;
              searchInput.focus();
              searchInput.selectionStart = searchInput.value.length;
              searchInput.selectionEnd = searchInput.value.length;
            }

            const dropdown = document.getElementById("searchEngineDropdown");
            if (dropdown) {
              dropdown.classList.add("hidden");
            }
          });
        });

        // Initialiser l'onglet actif
        const activeTab = localStorage.getItem("activeTab") || "personal";
        switchTab(activeTab);
      });

      function handleSearch(event) {
        if (
          (event.type === "keydown" && event.key === "Enter") ||
          event.type === "click"
        ) {
          event.preventDefault();

          let query = document.getElementById("searchInput").value.trim();
          let selectedEngine = document.getElementById("searchEngine").value;

          const searchEngines = {
            g: "https://www.google.com/search?q=",
            yt: "https://www.youtube.com/results?search_query=",
            gh: "https://github.com/search?q=",
            w: "https://en.wikipedia.org/wiki/Special:Search?search=",
            r: "https://www.reddit.com/search/?q=",
            so: "https://stackoverflow.com/search?q=",
            a: "https://www.amazon.fr/s?k=",
            n: "https://www.netflix.com/search?q=",
            sp: "https://open.spotify.com/search/results",
            tw: "https://twitter.com/search?q=",
            ig: "https://www.instagram.com/explore/tags/",
            maps: "https://www.google.com/maps/search/",
            i: "https://www.google.com/images?q=",
            ddg: "https://duckduckgo.com/?q=",
            px: "https://www.perplexity.ai/search?q=",
            as: "https://www.asialand.fr/jolisearch?s=", // Ajout asialand
            ac: "https://www.acadia-info.com/jolisearch?s=", // Ajout acadia
          };

          if (query.startsWith("/")) {
            const parts = query.substring(1).split(" ");
            if (parts.length > 1) {
              const possibleCommand = parts[0].toLowerCase();
              if (searchEngines[possibleCommand]) {
                selectedEngine = possibleCommand;
                query = parts.slice(1).join(" ");
              }
            }
          }

          let searchUrl = searchEngines[selectedEngine] || searchEngines["g"];
          // Ajout du traitement sp√©cial pour asialand et acadia
          if (selectedEngine === "as" || selectedEngine === "ac") {
            // Forcer tous les s√©parateurs √† √™tre des + non encod√©s
            query = query.replace(/%2B/gi, " "); // retire tout %2B √©ventuel
            query = query.replace(/\+/g, " "); // retire tout + √©ventuel
            query = query.trim().replace(/\s+/g, "+");
            window.location.href = searchUrl + query;
            return;
          }
          if (query) {
            window.location.href = searchUrl + encodeURIComponent(query);
          }
        }
      }

      function reloadShortcuts() {
        const grid = document.getElementById("shortcutGrid");
        const shortcuts = JSON.parse(localStorage.getItem("shortcuts") || "{}");
        
        // Supprimer tous les raccourcis existants mais garder le bouton d'ajout
        const addRowButton = document.getElementById("addRowButton");
        grid.innerHTML = '';
        
        // Recr√©er les raccourcis
        const shortcutCount = parseInt(localStorage.getItem("shortcutCount") || "8");
        for (let i = 0; i < shortcutCount; i++) {
          grid.innerHTML += generateShortcut(i);
        }
        
        // Remettre le bouton d'ajout
        grid.appendChild(addRowButton);
      
        // Mettre √† jour les raccourcis avec leurs donn√©es
        Object.entries(shortcuts).forEach(([position, data]) => {
          const shortcut = document.querySelector(`[data-position="${position}"]`);
          if (shortcut) {
            shortcut.href = data.url;
            shortcut.onclick = (e) => {
              e.preventDefault();
              window.location.href = data.url;
            };
            shortcut.querySelector(".shortcut-title").textContent = data.title;
            const iconContainer = shortcut.querySelector(".shortcut-icon");
            iconContainer.removeAttribute("data-empty");
            iconContainer.innerHTML = `
              <img src="${data.faviconUrl}" 
                 class="w-8 h-8 mt-2 mb-2 group-hover:scale-120 transition-transform duration-300" 
                 alt="${data.title}" 
                 onerror="this.src='data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'><text y=\'.9em\' font-size=\'90\'>üåê</text></svg>\'">`; 
          }
        });
      }

      function switchTab(tab) {
        // Don't do anything if we're already on the selected tab
        if (localStorage.getItem("activeTab") === tab) {
          return;
        }

        // Update visual interface
        document.getElementById("personalTab").classList.toggle("bg-white/60", tab === "personal");
        document.getElementById("professionalTab").classList.toggle("bg-white/60", tab === "professional");

        // Save active tab
        localStorage.setItem("activeTab", tab);

        // Load corresponding shortcuts
        const shortcuts = JSON.parse(localStorage.getItem(`shortcuts_${tab}`) || "{}");
        localStorage.setItem("shortcuts", JSON.stringify(shortcuts));

        // Reload shortcuts
        reloadShortcuts(); // Au lieu de reloadWithTransition()
      }
    </script>
  </head>
  <body class="min-h-screen font-sf">
    <!-- Suppression du bouton hamburger pour le remplacer par une barre de navigation mobile en bas -->

    <div class="flex min-h-screen p-6">
      <aside
        id="sidebar"
        class="w-72 backdrop-blur-xl bg-white/90 rounded-3xl p-6 space-y-4 shadow-2xl transition-all duration-300 mr-6 fixed lg:relative z-40 h-[calc(100vh-3rem)] overflow-y-auto hidden lg:block"
      >
        <div class="text-xl font-medium text-white mb-8">Quick Access</div>


        <div class="mt-6 mb-2 pr-4 pt-4 pb-4 pl-2 flex items-center gap-2">
          <svg
            class="w-6 h-6 text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M13.849 4.22c-.684-1.626-3.014-1.626-3.698 0L8.397 8.387l-4.552.361c-1.775.14-2.495 2.331-1.142 3.477l3.468 2.937-1.06 4.392c-.413 1.713 1.472 3.067 2.992 2.149L12 19.35l3.897 2.354c1.52.918 3.405-.436 2.992-2.15l-1.06-4.39 3.468-2.938c1.353-1.146.633-3.336-1.142-3.477l-4.552-.36-1.754-4.17Z"
            />
          </svg>

          <h3 class="text-white font-medium text-lg">Onglets</h3>
        </div>

        <div
          class="pr-4 pt-4 pb-4 pl-2 hover:bg-white/60 rounded-xl cursor-pointer text-white transition-all duration-300 flex items-center gap-3 bg-white/30"
          onclick="switchTab('personal')"
          id="personalTab"
        >
          <svg
            class="pl-2 w-9 text-white"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
            />
          </svg>
          <a id="perso" class="block w-full">Personnel</a>
        </div>
        <div
          class="pr-4 pt-4 pb-4 pl-2 hover:bg-white/60 rounded-xl cursor-pointer text-white transition-all duration-300 flex items-center gap-3 bg-white/30"
          onclick="switchTab('professional')"
          id="professionalTab"
        >
          <svg
            class="pl-2 w-9 text-white"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"
            />
          </svg>
          <a id="pro" class="block w-full">Professionnel</a>
        </div>
        <!-- My apps section -->
        <div class="mt-6 mb-2 pr-4 pt-4 pb-4 pl-2 flex items-center gap-2">
          <svg
            class="w-5 h-5 text-white"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"
            />
          </svg>
          <h3 class="text-white font-medium text-lg">Liens permanents</h3>
        </div>

        <div
          class="pr-4 pt-4 pb-4 pl-2 hover:bg-white/60 rounded-xl cursor-pointer text-white transition-all duration-300 flex items-center gap-3 bg-white/30"
        >
          <img
            src="https://dev.kilianbarbier.fr/media/img/coolnotes_128.png"
            class="pl-2 w-9"
            alt="CoolNotes"
          />
          <a href="https://dev.kilianbarbier.fr" class="block w-full"
            >CoolNotes</a
          >
        </div>
        
      </aside>

      <!-- Main Content -->
      <main class="flex-1 flex flex-col lg:ml-72 pb-20 lg:pb-0">
        <!-- Search Bar -->
        <div
          class="max-w-2xl mx-auto w-full mb-12 flex items-center gap-4 search-container relative z-30"
        >
          <div class="relative">
            <button
              id="currentSearch"
              class="relative z-[999999] px-5 h-12 bg-white/20 backdrop-blur-xl rounded-xl border-0 outline-none cursor-pointer hover:bg-white/30 transition-all duration-300 flex items-center justify-center"
            >
              <span class="pr-3 shortcut-title font-sf" style="font-weight: 400"
                >Rechercher sur :</span
              >
              <img
                src="https://www.google.com/images/branding/product/ico/googleg_lodp.ico"
                class="w-6 h-6"
                alt="Google"
              />
            </button>
            <div
              id="searchEngineDropdown"
              style="
                background: #d80808;
                border: 1px solid #9e0606;
                margin-top: 17px;
                width: 325px;
              "
              class="hidden absolute top-full left-0 mt-2 rounded-xl p-3 grid grid-cols-4 gap-3"
            >
              <button class="search-option rounded-lg" data-value="g">
                <img
                  src="https://favicone.com/www.google.com?s=128"
                  alt="Google"
                />
              </button>
              <button class="search-option rounded-lg" data-value="yt">
                <img
                  src="https://dev.kilianbarbier.fr/media/img/youtube_logo.svg"
                  alt="YouTube"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg flex items-center justify-center"
                data-value="gh"
              >
                <img
                  src="https://favicone.com/github.com?s=128"
                  class="w-6 h-6"
                  alt="GitHub"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="w"
              >
                <img
                  src="https://favicone.com/wikipedia.org?s=128"
                  class="w-6 h-6"
                  alt="Wikipedia"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="r"
              >
                <img
                  src="https://favicone.com/www.reddit.com?s=128"
                  class="w-6 h-6"
                  alt="Reddit"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="so"
              >
                <img
                  src="https://favicone.com/stackoverflow.com?s=128"
                  class="w-6 h-6"
                  alt="Stack"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="a"
              >
                <img
                  src="https://favicone.com/www.amazon.com?s=128"
                  class="w-6 h-6"
                  alt="Amazon"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="n"
              >
                <img
                  src="https://favicone.com/www.netflix.com?s=128"
                  class="w-6 h-6"
                  alt="Netflix"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="sp"
              >
                <img
                  src="https://favicone.com/open.spotify.com?s=128"
                  class="w-6 h-6"
                  alt="Spotify"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="tw"
              >
                <img
                  src="https://favicone.com/twitter.com?s=128"
                  class="w-6 h-6"
                  alt="Twitter"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="ig"
              >
                <img
                  src="https://favicone.com/www.instagram.com?s=128"
                  class="w-6 h-6"
                  alt="Instagram"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="maps"
              >
                <img
                  src="https://favicone.com/maps.google.com?s=128"
                  class="w-6 h-6"
                  alt="Maps"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="i"
              >
                <img
                src="https://dev.kilianbarbier.fr/media/img/google_img_logo.svg"
                class="w-6 h-6"
                  alt="Images"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="ddg"
              >
                <img
                  src="https://favicone.com/duckduckgo.com?s=128"
                  class="w-6 h-6"
                  alt="DuckDuckGo"
                />
              </button>
              <button
                class="search-option p-2 rounded-lg backdrop-blur-3xl"
                data-value="px"
              >
                <img
                  src="https://favicone.com/www.perplexity.ai?s=128"
                  class="w-6 h-6"
                  alt="Perplexity"
                />
              </button>
              <button class="search-option p-2 rounded-lg backdrop-blur-3xl" data-value="as">
                <img
                  src="https://www.asialand.fr/img/logo.png"
                  class="w-6 h-6"
                  alt="Asialand"
                />
              </button>
              <button class="search-option p-2 rounded-lg backdrop-blur-3xl" data-value="ac">
                <img
                  src="https://www.acadia-info.com/img/logo.png"
                  class="w-6 h-6"
                  alt="Acadia"
                />
              </button>
            </div>
            <select id="searchEngine" class="hidden">
              <option value="g">Google</option>
              <option value="yt">YouTube</option>
              <option value="gh">GitHub</option>
              <!-- ... garder les valeurs pour la fonctionnalit√© de recherche ... -->
              <option value="as">Asialand</option>
              <option value="ac">Acadia</option>
            </select>
          </div>

          <script>
            document
              .getElementById("currentSearch")
              .addEventListener("click", () => {
                const dropdown = document.getElementById(
                  "searchEngineDropdown"
                );
                dropdown.classList.toggle("hidden");
              });

            document.querySelectorAll(".search-option").forEach((option) => {
              option.addEventListener("click", (e) => {
                const value = e.currentTarget.dataset.value;
                const img = e.currentTarget.querySelector("img");

                // Mettre √† jour l'ic√¥ne visible
                document.querySelector("#currentSearch img").src = img.src;

                // Mettre √† jour le select cach√©
                document.getElementById("searchEngine").value = value;

                // Ajouter la commande au d√©but de la recherche
                const searchInput = document.getElementById("searchInput");
                const currentText = searchInput.value.trim();

                // Si le texte commence d√©j√† par une commande, on la remplace
                let newText = currentText;
                if (currentText.startsWith("/")) {
                  // Correction ici : startswith -> startsWith
                  const parts = currentText.substring(1).split(" ");
                  const possibleCommand = parts[0].toLowerCase();
                  // Liste des commandes valides (doit correspondre √† handleSearch)
                  const validCommands = [
                    "g",
                    "yt",
                    "gh",
                    "w",
                    "r",
                    "so",
                    "a",
                    "n",
                    "sp",
                    "tw",
                    "ig",
                    "maps",
                    "i",
                    "as", // Ajout du raccourci asialand
                    "ac", // Ajout du raccourci acadia
                  ];
                  if (validCommands.includes(possibleCommand)) {
                    // Prendre tout sauf la commande
                    newText = parts.slice(1).join(" ");
                  }
                }

                // Garantir qu'il y a toujours un espace apr√®s la commande si newText n'est pas vide
                if (newText.length > 0) {
                  searchInput.value = `/${value} ${newText}`;
                } else {
                  // Si pas de texte, ajouter juste la commande avec un espace √† la fin pour faciliter la saisie
                  searchInput.value = `/${value} `;
                }

                // Fermer le dropdown
                document
                  .getElementById("searchEngineDropdown")
                  .classList.add("hidden");

                // Remettre le focus sur le champ de recherche
                searchInput.focus();
                // Placer le curseur √† la fin du texte
                searchInput.selectionStart = searchInput.value.length;
                searchInput.selectionEnd = searchInput.value.length;
              });
            });

            // Fermer le dropdown si on clique ailleurs
            document.addEventListener("click", (e) => {
              if (!e.target.closest(".relative")) {
                document
                  .getElementById("searchEngineDropdown")
                  .classList.add("hidden");
              }
            });

            // Assurons-nous que le bouton de recherche d√©clenche la recherche avec le moteur s√©lectionn√©
            document
              .querySelector(".absolute svg")
              .addEventListener("click", function (event) {
                handleSearch(event);
              });

            // S'assurer que le document est pr√™t
            document.addEventListener("DOMContentLoaded", () => {
              // R√©initialiser les √©couteurs pour la recherche afin d'√©viter des doublons
              const searchInput = document.getElementById("searchInput");
              const searchIcon = document.querySelector(".absolute svg");

              // Supprimer les √©couteurs existants s'il y en a
              searchInput.removeEventListener("keydown", handleSearch);
              searchIcon.removeEventListener("click", handleSearch);

              // Ajouter les nouveaux √©couteurs
              searchInput.addEventListener("keydown", handleSearch);
              searchIcon.addEventListener("click", handleSearch);
            });
          </script>
          <div class="relative flex-1">
            <input
              type="text"
              placeholder="Search..."
              id="searchInput"
              class="w-full px-6 py-4 rounded-2xl shadow-lg border-0 bg-white/90 backdrop-blur-xl text-white text-lg focus:outline-none focus:ring-2 focus:ring-blue-400/30 transition-all duration-300 placeholder-white/50"
            />
            <svg
              class="absolute right-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-white"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="{2}"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
          </div>
          <button
            onclick="showSearchHelp()"
            class="text-white hover:text-white/80 text-xl font-medium w-10 h-10 rounded-full bg-white/20 backdrop-blur-xl flex items-center justify-center hover:bg-white/30 transition-all duration-300"
          >
            ?
          </button>
        </div>

        <!-- Grid Shortcuts -->
        <div
          id="shortcutGrid"
          class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 max-w-5xl mx-auto w-full"
        ></div>

        <!-- Configuration Modal simplifi√© -->
        <div
          id="configModal"
          class="hidden fixed inset-0 bg-black/40 backdrop-blur-xl flex items-center justify-center"
        >
          <div
            class="modal-content bg-white/95 rounded-2xl p-6 w-96 shadow-2xl backdrop-blur-xl"
          >
            <h2 class="text-2xl font-bold mb-4 text-gray-900">Ajouter un raccourci</h2>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Titre</label
                >
                <input
                  type="text"
                  id="shortcutTitle"
                  oninput="validateForm()"
                  placeholder="Facebook"
                  class="mt-1 w-full rounded-lg px-3 py-2 text-gray-900 bg-gray-50 placeholder-gray-400"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >URL</label
                >
                <input
                  type="url"
                  id="shortcutUrl"
                  oninput="validateForm()"
                  placeholder="facebook.com"
                  class="mt-1 w-full rounded-lg px-3 py-2 text-gray-900 bg-gray-50 placeholder-gray-400"
                />
                <p id="urlError" class="mt-1 text-sm text-red-500 hidden">
                  Veuillez entrer une URL valide (ex: google.com)
                </p>
              </div>
              <div class="flex justify-end gap-2 mt-6">
                <button
                  onclick="closeConfigModal()"
                  class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300"
                >
                  Annuler
                </button>
                <button
                  id="saveButton"
                  onclick="saveShortcut()"
                  disabled
                  class="px-4 py-2 rounded-lg bg-blue-400/80 text-white transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-500/80"
                >
                    <span class="flex items-center gap-2 font-medium">
                    <svg class="animate-spin h-4 w-4 text-white hidden" id="saveSpinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity.25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span id="saveText">Ajouter</span>
                    </span></span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <script>
          // Liste des extensions de domaine courantes
          const validTLDs = [
            "com",
            "net",
            "org",
            "edu",
            "gov",
            "mil",
            "io",
            "co",
            "ai",
            "app",
            "dev",
            "me",
            "tv",
            "info",
            "biz",
            "name",
            "mobi",
            "pro",
            "travel",
            // Domaines nationaux courants
            "fr",
            "uk",
            "de",
            "it",
            "es",
            "nl",
            "ru",
            "cn",
            "jp",
            "kr",
            "br",
            "au",
            "ca",
            "in",
            "eu",
          ];

          function isValidUrl(string) {
            try {
              const url = string.trim();
              if (!url) return false;

              // Ajouter https:// si n√©cessaire
              const urlToTest = url.match(/^https?:\/\//i)
                ? url
                : `https://${url}`;
              const urlObj = new URL(urlToTest);

              // V√©rifier le hostname
              const parts = urlObj.hostname.split(".");
              if (parts.length < 2) return false;

              // V√©rifier que l'extension respecte le format standard
              // Une extension est typiquement 2-12 caract√®res et contient uniquement des lettres
              const tld = parts[parts.length - 1].toLowerCase();
              return /^[a-z]{2,12}$/.test(tld);
            } catch (err) {
              return false;
            }
          }

          // Fonction de validation am√©lior√©e
          function validateForm() {
            const title = document.getElementById("shortcutTitle").value.trim();
            const url = document.getElementById("shortcutUrl").value.trim();
            const saveButton = document.getElementById("saveButton");
            const urlError = document.getElementById("urlError");

            const isTitleValid = title.length > 0;
            const isUrlValid = isValidUrl(url);

            // Afficher/masquer le message d'erreur
            if (url && !isUrlValid) {
              urlError.classList.remove("hidden");
            } else {
              urlError.classList.add("hidden");
            }

            saveButton.disabled = !isTitleValid || !isUrlValid;
          }

          // Modification de openConfigModal pour r√©initialiser l'√©tat du bouton
          function openConfigModal(position) {
            const modal = document.getElementById("configModal");
            modal.setAttribute("data-position", position);

            document.getElementById("shortcutTitle").value = "";
            document.getElementById("shortcutUrl").value = "";
            document.getElementById("saveButton").disabled = true;

            modal.classList.remove("hidden");
            document.getElementById("shortcutTitle").focus();
          }
        </script>
        <div
          id="contextMenu"
          class="hidden fixed rounded-lg shadow-2xl py-2 min-w-[150px] z-50 bg-black/40 backdrop-blur-xl border border-white/10"
        >
          <button
            onclick="editShortcut(document.getElementById('contextMenu').getAttribute('data-position'))"
            class="w-full border-t-0 border-r-0 border-l-0 border-b-0 px-4 py-2 text-left hover:bg-white/10 text-gray-200 transition-colors duration-200"
          >
            Edit Shortcut
          </button>
          <button
            onclick="deleteShortcut()"
            class="w-full border-b-0 border-r-0 border-l-0 px-4 py-2 text-left hover:bg-red-500/20 text-red-300 transition-colors duration-200"
          >
            Delete Shortcut
          </button>
        </div>

        <!-- Add search help modal -->
        <div
          id="searchHelpModal"
          class="hidden fixed inset-0 bg-black/40 backdrop-blur-xl flex items-center justify-center z-50"
        >
          <div
            class="bg-white/95 rounded-2xl p-6 w-[500px] shadow-2xl backdrop-blur-xl"
          >
            <h2 class="text-2xl font-bold mb-4 text-white">Commandes de recherche</h2>
            <div class="grid grid-cols-2 gap-4 text-white">
              <div>
                <p><strong>&#47;g</strong> - Google</p>
                <p><strong>&#47;yt</strong> - YouTube</p>
                <p><strong>&#47;gh</strong> - GitHub</p>
                <p><strong>&#47;w</strong> - Wikipedia</p>
                <p><strong>&#47;r</strong> - Reddit</p>
                <p><strong>&#47;so</strong> - Stack Overflow</p>
                <p><strong>&#47;i</strong> - Google Images</p>
                <p><strong>&#47;ddg</strong> - DuckDuckGo</p>
                <p><strong>&#47;px</strong> - Perplexity AI</p>
              </div>
              <div>
                <p><strong>&#47;a</strong> - Amazon</p>
                <p><strong>&#47;n</strong> - Netflix</p>
                <p><strong>&#47;sp</strong> - Spotify</p>
                <p><strong>&#47;tw</strong> - Twitter</p>
                <p><strong>&#47;ig</strong> - Instagram Tags</p>
                <p><strong>&#47;maps</strong> - Google Maps</p>
                <p><strong>&#47;as</strong> - Asialand</p>
                <p><strong>&#47;ac</strong> - Acadia</p>
              </div>
            </div>
            <div class="mt-6 text-white/80">
              <p>Exemple: <code>/yt chats mignons</code>, recherche directement sur Youtube "chats mignons".</p>
              <p>
                Astuce: Utilise un slash (/) avant une commande, ou bien tape juste ta recherche pour rechercher avec Google
              </p>
            </div>
            <button
              onclick="closeSearchHelp()"
              class="mt-6 px-4 py-2 bg-white/20 hover:bg-white/30 rounded text-white"
            >
              Close
            </button>
          </div>
        </div>

        <script>
          function showSearchHelp() {
            document
              .getElementById("searchHelpModal")
              .classList.remove("hidden");
          }

          function closeSearchHelp() {
            document.getElementById("searchHelpModal").classList.add("hidden");
          }
        </script>
      </main>
    </div>

    <!-- Navigation bar mobile en bas de l'√©cran -->
    <nav
      id="mobileNavBar"
      class="fixed bottom-0 left-0 right-0 bg-black/60 backdrop-blur-xl p-2 z-50 lg:hidden"
    >
      <div class="flex justify-center items-center">
        <div class="flex items-center gap-5">
          <button
            id="showSidebar"
            class="flex flex-col items-center py-1 px-3 text-white/80 hover:text-white transition-colors rounded-xl"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"
              ></path>
            </svg>
            <span class="text-xs">Acc√®s rapide</span>
          </button>
          <button
            onclick="showSearchHelp()"
            class="mr-2 flex flex-col items-center py-1 px-3 text-white/80 hover:text-white transition-colors rounded-xl"
          >
            <span
              class="text-xl font-medium w-6 h-6 flex items-center justify-center"
              >?</span
            >
            <span class="text-xs">Centre d'aide</span>
          </button>
        </div>
      </div>
    </nav>

    <!-- Ajout d'un modal pour afficher la sidebar sur mobile -->
    <div
      id="sidebarModal"
      class="fixed inset-0 bg-black/40 backdrop-blur-md z-[60] hidden"
    >
      <div
        class="fixed bottom-0 inset-x-0 rounded-t-3xl bg-white/90 backdrop-blur-xl p-6 shadow-2xl max-h-[80vh] overflow-y-auto transition-transform duration-300 transform translate-y-0"
      >
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-medium text-white">Acc√®s rapide</h2>
          <button
            id="closeSidebar"
            class="p-2 text-white rounded-full bg-white/20 hover:bg-white/30"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>
        <div id="sidebarContent" class="space-y-4">
          <!-- Le contenu de la sidebar sera clon√© ici via JavaScript -->
        </div>
      </div>
    </div>

    <!-- Ajout des styles pour le menu mobile -->
    <style>
      @media (min-width: 1024px) {
        main {
          margin-left: 0 !important;
        }
      }

      /* Add these new styles for the tooltip */
      .shortcut-container {
        position: relative;
      }

      .shortcut-container::before {
        content: "Clic droit pour √©diter ou supprimer";
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        opacity: 0;
        transition: opacity 0.2s ease;
        pointer-events: none;
        white-space: nowrap;
        backdrop-filter: blur(4px);
      }

      .shortcut-container:hover::before {
        opacity: 1;
      }
    </style>

    <!-- Script pour cloner le contenu de la sidebar dans le modal mobile -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Cloner le contenu de la sidebar pour le modal mobile
        const sidebarChildren = document.querySelectorAll(
          "#sidebar > *:not(:first-child)"
        );
        const sidebarContent = document.getElementById("sidebarContent");

        sidebarChildren.forEach((child) => {
          sidebarContent.appendChild(child.cloneNode(true));
        });

        // Gestion de l'affichage du modal
        const showSidebarBtn = document.getElementById("showSidebar");
        const closeSidebarBtn = document.getElementById("closeSidebar");
        const sidebarModal = document.getElementById("sidebarModal");

        showSidebarBtn.addEventListener("click", function () {
          sidebarModal.classList.remove("hidden");
          document.body.style.overflow = "hidden"; // Emp√™cher le d√©filement du body
        });

        closeSidebarBtn.addEventListener("click", function () {
          sidebarModal.classList.add("hidden");
          document.body.style.overflow = ""; // R√©activer le d√©filement
        });

        // Fermer le modal si on clique en dehors du contenu
        sidebarModal.addEventListener("click", function (e) {
          if (e.target === sidebarModal) {
            sidebarModal.classList.add("hidden");
            document.body.style.overflow = "";
          }
        });
      });
    </script>
  </body>
</html>
